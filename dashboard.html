<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Supabase App</title>
</head>
<body>
    <div id="app">
        <header>
            <h1>üöÄ Interactive User Hub</h1>
            <div id="auth-section">
                <div id="login-section">
                    <button id="login-btn">üîê Login with Google</button>
                </div>
                <div id="user-section" style="display: none;">
                    <span>Welcome, <span id="user-name"></span>!</span>
                    <button id="logout-btn">üö™ Logout</button>
                </div>
            </div>
        </header>

        <div id="main-content" style="display: none;">
            <div id="tabs">
                <button class="tab-btn active" data-tab="dashboard">üìä Dashboard</button>
                <button class="tab-btn" data-tab="users">üë• Online Users</button>
                <button class="tab-btn" data-tab="chat">üí¨ Live Chat</button>
                <button class="tab-btn" data-tab="profile">üë§ Profile</button>
                <button class="tab-btn" data-tab="activities">üìà Activities</button>
                <button class="tab-btn" data-tab="notifications">üîî Notifications</button>
            </div>

            <!-- Dashboard Tab -->
            <div id="dashboard-tab" class="tab-content active">
                <h2>üìä Dashboard</h2>
                <div id="stats">
                    <div class="stat-card">
                        <h3>Total Users</h3>
                        <span id="total-users">0</span>
                    </div>
                    <div class="stat-card">
                        <h3>Online Now</h3>
                        <span id="online-users">0</span>
                    </div>
                    <div class="stat-card">
                        <h3>Messages Today</h3>
                        <span id="messages-today">0</span>
                    </div>
                    <div class="stat-card">
                        <h3>Your Activities</h3>
                        <span id="user-activities-count">0</span>
                    </div>
                </div>
                <div id="recent-activity">
                    <h3>üî• Recent Platform Activity</h3>
                    <ul id="activity-list"></ul>
                </div>
            </div>

            <!-- Users Tab -->
            <div id="users-tab" class="tab-content">
                <h2>üë• Online Users</h2>
                <div id="user-controls">
                    <button id="refresh-users">üîÑ Refresh Users</button>
                    <button id="ping-all">üì¢ Ping All Users</button>
                </div>
                <div id="users-list"></div>
            </div>

            <!-- Chat Tab -->
            <div id="chat-tab" class="tab-content">
                <h2>üí¨ Live Chat</h2>
                <div id="chat-messages"></div>
                <div id="chat-input-section">
                    <input type="text" id="message-input" placeholder="Type your message..." maxlength="500">
                    <button id="send-message">üì§ Send</button>
                    <button id="send-emoji">üòä Random Emoji</button>
                    <button id="clear-chat">üóëÔ∏è Clear Chat</button>
                </div>
            </div>

            <!-- Profile Tab -->
            <div id="profile-tab" class="tab-content">
                <h2>üë§ Your Profile</h2>
                <form id="profile-form">
                    <div>
                        <label>Full Name:</label>
                        <input type="text" id="profile-name" placeholder="Enter your full name">
                    </div>
                    <div>
                        <label>Bio:</label>
                        <textarea id="profile-bio" placeholder="Tell us about yourself..." rows="3"></textarea>
                    </div>
                    <div>
                        <label>Status:</label>
                        <select id="profile-status">
                            <option value="online">üü¢ Online</option>
                            <option value="away">üü° Away</option>
                            <option value="busy">üî¥ Busy</option>
                            <option value="offline">‚ö´ Offline</option>
                        </select>
                    </div>
                    <button type="submit">üíæ Update Profile</button>
                </form>
                <div id="profile-actions">
                    <button id="export-data">üì¶ Export My Data</button>
                    <button id="delete-activities">üóëÔ∏è Clear My Activities</button>
                </div>
            </div>

            <!-- Activities Tab -->
            <div id="activities-tab" class="tab-content">
                <h2>üìà Your Activities</h2>
                <div id="activity-controls">
                    <button id="add-custom-activity">‚ûï Add Custom Activity</button>
                    <button id="generate-fake-activity">üé≤ Generate Sample Activity</button>
                    <select id="activity-filter">
                        <option value="all">All Activities</option>
                        <option value="login">Logins</option>
                        <option value="message">Messages</option>
                        <option value="profile_update">Profile Updates</option>
                        <option value="custom">Custom</option>
                    </select>
                </div>
                <div id="user-activities-list"></div>
            </div>

            <!-- Notifications Tab -->
            <div id="notifications-tab" class="tab-content">
                <h2>üîî Notifications</h2>
                <div id="notification-controls">
                    <button id="mark-all-read">‚úÖ Mark All Read</button>
                    <button id="create-test-notification">üß™ Create Test Notification</button>
                    <button id="clear-notifications">üóëÔ∏è Clear All</button>
                </div>
                <div id="notifications-list"></div>
            </div>
        </div>
    </div>

    <script type="module">
        import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm";
        
        const SUPABASE_URL = "https://jcrbwmpapgovyqaxajlb.supabase.co";
        const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpjcmJ3bXBhcGdvdnlxYXhhamxiIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTcwNDc2NjAsImV4cCI6MjA3MjYyMzY2MH0.7jMgdHQGWfAsQ9b5C2gn8z7YqFLuA6gR_gIF0VIW56M";
        const sb = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        
        let currentUser = null;
        let subscriptions = [];
        
        // Initialize app
        document.addEventListener('DOMContentLoaded', () => {
            setupAuthListeners();
            setupTabNavigation();
            setupInteractions();
            checkInitialAuth();
        });
        
        // Auth state management
        sb.auth.onAuthStateChange(async (event, session) => {
            console.log('Auth state changed:', event, session);
            
            if (session) {
                currentUser = session.user;
                await handleUserLogin(session.user);
                showMainContent();
                await setupRealTimeSubscriptions();
                await loadInitialData();
            } else {
                currentUser = null;
                hideMainContent();
                cleanupSubscriptions();
            }
        });
        
        async function checkInitialAuth() {
            const { data: { session } } = await sb.auth.getSession();
            if (session) {
                currentUser = session.user;
                await handleUserLogin(session.user);
                showMainContent();
                await setupRealTimeSubscriptions();
                await loadInitialData();
            }
        }
        
        async function handleUserLogin(user) {
            // Update UI
            document.getElementById('user-name').textContent = user.user_metadata.full_name || user.email;
            
            // Upsert user profile
            await sb.from('user_profiles').upsert({
                id: user.id,
                email: user.email,
                full_name: user.user_metadata.full_name,
                avatar_url: user.user_metadata.avatar_url,
                status: 'online',
                last_seen: new Date().toISOString()
            });
            
            // Log login activity
            await logActivity('login', { login_time: new Date().toISOString() });
        }
        
        function setupAuthListeners() {
            document.getElementById('login-btn').addEventListener('click', async () => {
                await sb.auth.signInWithOAuth({
                    provider: 'google',
                    options: {
                        redirectTo: window.location.origin
                    }
                });
            });
            
            document.getElementById('logout-btn').addEventListener('click', async () => {
                // Update status to offline before logout
                if (currentUser) {
                    await sb.from('user_profiles').update({
                        status: 'offline',
                        last_seen: new Date().toISOString()
                    }).eq('id', currentUser.id);
                }
                await sb.auth.signOut();
            });
        }
        
        function showMainContent() {
            document.getElementById('login-section').style.display = 'none';
            document.getElementById('user-section').style.display = 'block';
            document.getElementById('main-content').style.display = 'block';
        }
        
        function hideMainContent() {
            document.getElementById('login-section').style.display = 'block';
            document.getElementById('user-section').style.display = 'none';
            document.getElementById('main-content').style.display = 'none';
        }
        
        // Tab navigation
        function setupTabNavigation() {
            const tabBtns = document.querySelectorAll('.tab-btn');
            const tabContents = document.querySelectorAll('.tab-content');
            
            tabBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    const targetTab = btn.dataset.tab;
                    
                    // Remove active class from all tabs
                    tabBtns.forEach(b => b.classList.remove('active'));
                    tabContents.forEach(content => content.classList.remove('active'));
                    
                    // Add active class to clicked tab
                    btn.classList.add('active');
                    document.getElementById(`${targetTab}-tab`).classList.add('active');
                    
                    // Load tab-specific data
                    loadTabData(targetTab);
                });
            });
        }
        
        async function loadTabData(tab) {
            switch (tab) {
                case 'users':
                    await loadUsers();
                    break;
                case 'chat':
                    await loadMessages();
                    break;
                case 'profile':
                    await loadProfile();
                    break;
                case 'activities':
                    await loadActivities();
                    break;
                case 'notifications':
                    await loadNotifications();
                    break;
                case 'dashboard':
                    await loadDashboard();
                    break;
            }
        }
        
        // Real-time subscriptions
        async function setupRealTimeSubscriptions() {
            // Subscribe to user profiles changes
            const profileSub = sb
                .channel('user_profiles_changes')
                .on('postgres_changes', { event: '*', schema: 'public', table: 'user_profiles' }, 
                    payload => handleUserProfileChange(payload))
                .subscribe();
            
            // Subscribe to new messages
            const messagesSub = sb
                .channel('messages_changes')
                .on('postgres_changes', { event: 'INSERT', schema: 'public', table: 'messages' }, 
                    payload => handleNewMessage(payload))
                .subscribe();
            
            // Subscribe to activities
            const activitiesSub = sb
                .channel('activities_changes')
                .on('postgres_changes', { event: 'INSERT', schema: 'public', table: 'user_activities' }, 
                    payload => handleNewActivity(payload))
                .subscribe();
            
            // Subscribe to notifications
            const notificationsSub = sb
                .channel('notifications_changes')
                .on('postgres_changes', { event: 'INSERT', schema: 'public', table: 'notifications' }, 
                    payload => handleNewNotification(payload))
                .subscribe();
            
            subscriptions = [profileSub, messagesSub, activitiesSub, notificationsSub];
        }
        
        function cleanupSubscriptions() {
            subscriptions.forEach(sub => sub.unsubscribe());
            subscriptions = [];
        }
        
        // Event handlers for real-time updates
        function handleUserProfileChange(payload) {
            console.log('User profile changed:', payload);
            if (document.querySelector('#users-tab.active')) {
                loadUsers();
            }
            loadDashboard(); // Update stats
        }
        
        function handleNewMessage(payload) {
            console.log('New message:', payload);
            if (document.querySelector('#chat-tab.active')) {
                displayNewMessage(payload.new);
            }
        }
        
        function handleNewActivity(payload) {
            console.log('New activity:', payload);
            if (document.querySelector('#activities-tab.active')) {
                loadActivities();
            }
            if (document.querySelector('#dashboard-tab.active')) {
                loadDashboard();
            }
        }
        
        function handleNewNotification(payload) {
            console.log('New notification:', payload);
            if (payload.new.user_id === currentUser.id) {
                showNotificationAlert(payload.new);
                if (document.querySelector('#notifications-tab.active')) {
                    loadNotifications();
                }
            }
        }
        
        // Setup all interactive features
        function setupInteractions() {
            setupChatInteractions();
            setupUserInteractions();
            setupProfileInteractions();
            setupActivityInteractions();
            setupNotificationInteractions();
        }
        
        function setupChatInteractions() {
            const messageInput = document.getElementById('message-input');
            const sendBtn = document.getElementById('send-message');
            
            sendBtn.addEventListener('click', sendMessage);
            messageInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') sendMessage();
            });
            
            document.getElementById('send-emoji').addEventListener('click', () => {
                const emojis = ['üòä', 'üëç', '‚ù§Ô∏è', 'üòÇ', 'üî•', '‚ú®', 'üéâ', 'üöÄ', 'üíØ', 'üëè'];
                const randomEmoji = emojis[Math.floor(Math.random() * emojis.length)];
                messageInput.value = randomEmoji;
                sendMessage();
            });
            
            document.getElementById('clear-chat').addEventListener('click', async () => {
                if (confirm('Clear all chat messages?')) {
                    await sb.from('messages').delete().neq('id', '00000000-0000-0000-0000-000000000000');
                    document.getElementById('chat-messages').innerHTML = '';
                }
            });
        }
        
        function setupUserInteractions() {
            document.getElementById('refresh-users').addEventListener('click', loadUsers);
            document.getElementById('ping-all').addEventListener('click', async () => {
                // Create notification for all users
                const { data: users } = await sb.from('user_profiles').select('id');
                
                for (const user of users || []) {
                    await sb.from('notifications').insert({
                        user_id: user.id,
                        title: 'üì¢ Ping from ' + currentUser.user_metadata.full_name,
                        message: 'You have been pinged!',
                        notification_type: 'ping'
                    });
                }
                
                alert('Pinged all users!');
            });
        }
        
        function setupProfileInteractions() {
            document.getElementById('profile-form').addEventListener('submit', updateProfile);
            
            document.getElementById('export-data').addEventListener('click', async () => {
                const userData = await exportUserData();
                downloadJSON(userData, `user-data-${currentUser.id}.json`);
            });
            
            document.getElementById('delete-activities').addEventListener('click', async () => {
                if (confirm('Delete all your activities?')) {
                    await sb.from('user_activities').delete().eq('user_id', currentUser.id);
                    await loadActivities();
                }
            });
        }
        
        function setupActivityInteractions() {
            document.getElementById('add-custom-activity').addEventListener('click', () => {
                const activity = prompt('Enter custom activity:');
                if (activity) {
                    logActivity('custom', { custom_activity: activity });
                }
            });
            
            document.getElementById('generate-fake-activity').addEventListener('click', () => {
                const activities = [
                    'Viewed dashboard',
                    'Updated settings',
                    'Shared content',
                    'Completed task',
                    'Joined meeting'
                ];
                const randomActivity = activities[Math.floor(Math.random() * activities.length)];
                logActivity('generated', { activity: randomActivity });
            });
            
            document.getElementById('activity-filter').addEventListener('change', loadActivities);
        }
        
        function setupNotificationInteractions() {
            document.getElementById('mark-all-read').addEventListener('click', async () => {
                await sb.from('notifications').update({ is_read: true }).eq('user_id', currentUser.id);
                await loadNotifications();
            });
            
            document.getElementById('create-test-notification').addEventListener('click', async () => {
                await sb.from('notifications').insert({
                    user_id: currentUser.id,
                    title: 'üß™ Test Notification',
                    message: 'This is a test notification created at ' + new Date().toLocaleString(),
                    notification_type: 'test'
                });
            });
            
            document.getElementById('clear-notifications').addEventListener('click', async () => {
                if (confirm('Clear all notifications?')) {
                    await sb.from('notifications').delete().eq('user_id', currentUser.id);
                    await loadNotifications();
                }
            });
        }
        
        // Data loading functions
        async function loadInitialData() {
            await loadDashboard();
        }
        
        async function loadDashboard() {
            // Load statistics
            const { data: users } = await sb.from('user_profiles').select('*');
            const onlineUsers = users?.filter(u => u.status === 'online') || [];
            
            const { data: messages } = await sb.from('messages')
                .select('*')
                .gte('created_at', new Date(Date.now() - 24 * 60 * 60 * 1000).toISOString());
            
            const { data: userActivities } = await sb.from('user_activities')
                .select('*')
                .eq('user_id', currentUser.id);
            
            document.getElementById('total-users').textContent = users?.length || 0;
            document.getElementById('online-users').textContent = onlineUsers.length;
            document.getElementById('messages-today').textContent = messages?.length || 0;
            document.getElementById('user-activities-count').textContent = userActivities?.length || 0;
            
            // Load recent activities
            const { data: recentActivities } = await sb
                .from('user_activities')
                .select(`
                    *,
                    user_profiles:user_id (full_name, email)
                `)
                .order('created_at', { ascending: false })
                .limit(10);
            
            const activityList = document.getElementById('activity-list');
            activityList.innerHTML = '';
            
            recentActivities?.forEach(activity => {
                const li = document.createElement('li');
                const userName = activity.user_profiles?.full_name || activity.user_profiles?.email || 'Unknown';
                li.innerHTML = `<strong>${userName}</strong>: ${activity.activity_type} - ${new Date(activity.created_at).toLocaleString()}`;
                activityList.appendChild(li);
            });
        }
        
        async function loadUsers() {
            const { data: users } = await sb.from('user_profiles').select('*').order('last_seen', { ascending: false });
            
            const usersList = document.getElementById('users-list');
            usersList.innerHTML = '';
            
            users?.forEach(user => {
                const userDiv = document.createElement('div');
                userDiv.className = 'user-card';
                
                const statusEmoji = {
                    'online': 'üü¢',
                    'away': 'üü°',
                    'busy': 'üî¥',
                    'offline': '‚ö´'
                };
                
                userDiv.innerHTML = `
                    <div class="user-info">
                        <img src="${user.avatar_url || 'https://via.placeholder.com/40'}" alt="Avatar" width="40" height="40">
                        <div>
                            <strong>${user.full_name || user.email}</strong>
                            <br>
                            ${statusEmoji[user.status]} ${user.status}
                            <br>
                            <small>Last seen: ${new Date(user.last_seen).toLocaleString()}</small>
                            ${user.bio ? `<br><em>${user.bio}</em>` : ''}
                        </div>
                    </div>
                    <div class="user-actions">
                        <button onclick="sendNotificationToUser('${user.id}')">üìß Notify</button>
                        ${user.id !== currentUser.id ? `<button onclick="sendPrivateMessage('${user.id}')">üí¨ Message</button>` : ''}
                    </div>
                `;
                
                usersList.appendChild(userDiv);
            });
        }
        
        async function loadMessages() {
            const { data: messages } = await sb
                .from('messages')
                .select(`
                    *,
                    user_profiles:user_id (full_name, email, avatar_url)
                `)
                .order('created_at', { ascending: true })
                .limit(50);
            
            const chatMessages = document.getElementById('chat-messages');
            chatMessages.innerHTML = '';
            
            messages?.forEach(message => displayMessage(message));
            
            // Scroll to bottom
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }
        
        function displayMessage(message) {
            const chatMessages = document.getElementById('chat-messages');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message';
            
            const userName = message.user_profiles?.full_name || message.user_profiles?.email || 'Unknown';
            const isOwnMessage = message.user_id === currentUser.id;
            
            messageDiv.innerHTML = `
                <div class="message-header">
                    <img src="${message.user_profiles?.avatar_url || 'https://via.placeholder.com/30'}" width="30" height="30">
                    <strong>${userName}</strong>
                    ${isOwnMessage ? '<span class="own-message">üë§</span>' : ''}
                    <span class="timestamp">${new Date(message.created_at).toLocaleTimeString()}</span>
                </div>
                <div class="message-content">${message.content}</div>
            `;
            
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }
        
        function displayNewMessage(message) {
            displayMessage(message);
        }
        
        async function loadProfile() {
            const { data: profile } = await sb
                .from('user_profiles')
                .select('*')
                .eq('id', currentUser.id)
                .single();
            
            if (profile) {
                document.getElementById('profile-name').value = profile.full_name || '';
                document.getElementById('profile-bio').value = profile.bio || '';
                document.getElementById('profile-status').value = profile.status || 'online';
            }
        }
        
        async function loadActivities() {
            const filter = document.getElementById('activity-filter').value;
            
            let query = sb.from('user_activities').select('*').eq('user_id', currentUser.id);
            
            if (filter !== 'all') {
                query = query.eq('activity_type', filter);
            }
            
            const { data: activities } = await query.order('created_at', { ascending: false });
            
            const activitiesList = document.getElementById('user-activities-list');
            activitiesList.innerHTML = '';
            
            activities?.forEach(activity => {
                const activityDiv = document.createElement('div');
                activityDiv.className = 'activity-item';
                activityDiv.innerHTML = `
                    <div>
                        <strong>${activity.activity_type}</strong>
                        <span class="timestamp">${new Date(activity.created_at).toLocaleString()}</span>
                    </div>
                    <div>${JSON.stringify(activity.activity_data, null, 2)}</div>
                `;
                activitiesList.appendChild(activityDiv);
            });
        }
        
        async function loadNotifications() {
            const { data: notifications } = await sb
                .from('notifications')
                .select('*')
                .eq('user_id', currentUser.id)
                .order('created_at', { ascending: false });
            
            const notificationsList = document.getElementById('notifications-list');
            notificationsList.innerHTML = '';
            
            notifications?.forEach(notification => {
                const notificationDiv = document.createElement('div');
                notificationDiv.className = `notification ${notification.is_read ? 'read' : 'unread'}`;
                notificationDiv.innerHTML = `
                    <div class="notification-header">
                        <strong>${notification.title}</strong>
                        <span class="timestamp">${new Date(notification.created_at).toLocaleString()}</span>
                        ${!notification.is_read ? '<span class="unread-indicator">üî¥</span>' : ''}
                    </div>
                    <div class="notification-message">${notification.message || ''}</div>
                    <div class="notification-actions">
                        ${!notification.is_read ? `<button onclick="markNotificationRead('${notification.id}')">‚úÖ Mark Read</button>` : ''}
                        <button onclick="deleteNotification('${notification.id}')">üóëÔ∏è Delete</button>
                    </div>
                `;
                notificationsList.appendChild(notificationDiv);
            });
        }
        
        // Action functions
        async function sendMessage() {
            const messageInput = document.getElementById('message-input');
            const content = messageInput.value.trim();
            
            if (!content) return;
            
            await sb.from('messages').insert({
                user_id: currentUser.id,
                content: content,
                message_type: 'text'
            });
            
            messageInput.value = '';
            await logActivity('message', { message_length: content.length });
        }
        
        async function updateProfile(e) {
            e.preventDefault();
            
            const name = document.getElementById('profile-name').value;
            const bio = document.getElementById('profile-bio').value;
            const status = document.getElementById('profile-status').value;
            
            await sb.from('user_profiles').update({
                full_name: name,
                bio: bio,
                status: status,
                updated_at: new Date().toISOString()
            }).eq('id', currentUser.id);
            
            await logActivity('profile_update', { 
                updated_fields: { name, bio, status }
            });
            
            alert('Profile updated successfully!');
        }
        
        async function logActivity(type, data) {
            await sb.from('user_activities').insert({
                user_id: currentUser.id,
                activity_type: type,
                activity_data: data
            });
        }
        
        async function exportUserData() {
            const { data: profile } = await sb.from('user_profiles').select('*').eq('id', currentUser.id).single();
            const { data: messages } = await sb.from('messages').select('*').eq('user_id', currentUser.id);
            const { data: activities } = await sb.from('user_activities').select('*').eq('user_id', currentUser.id);
            const { data: notifications } = await sb.from('notifications').select('*').eq('user_id', currentUser.id);
            
            return {
                export_date: new Date().toISOString(),
                user_id: currentUser.id,
                profile,
                messages,
                activities,
                notifications
            };
        }
        
        function downloadJSON(data, filename) {
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }
        
        function showNotificationAlert(notification) {
            // Create a temporary alert for new notifications
            const alert = document.createElement('div');
            alert.className = 'notification-alert';
            alert.innerHTML = `
                <strong>New Notification!</strong><br>
                ${notification.title}<br>
                <small>${notification.message}</small>
            `;
            alert.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: #4CAF50;
                color: white;
                padding: 15px;
                border-radius: 5px;
                z-index: 1000;
                max-width: 300px;
            `;
            
            document.body.appendChild(alert);
            setTimeout(() => {
                document.body.removeChild(alert);
            }, 5000);
        }
        
        // Global functions for button clicks
        window.sendNotificationToUser = async function(userId) {
            const message = prompt('Enter notification message:');
            if (message) {
                await sb.from('notifications').insert({
                    user_id: userId,
                    title: `Message from ${currentUser.user_metadata.full_name}`,
                    message: message,
                    notification_type: 'user_message'
                });
                alert('Notification sent!');
            }
        };
        
        window.sendPrivateMessage = async function(userId) {
            const message = prompt('Enter private message:');
            if (message) {
                // For this demo, we'll send it as a notification
                await sb.from('notifications').insert({
                    user_id: userId,
                    title: `Private message from ${currentUser.user_metadata.full_name}`,
                    message: message,
                    notification_type: 'private_message'
                });
                alert('Private message sent!');
            }
        };
        
        window.markNotificationRead = async function(notificationId) {
            await sb.from('notifications').update({ is_read: true }).eq('id', notificationId);
            await loadNotifications();
        };
        
        window.deleteNotification = async function(notificationId) {
            await sb.from('notifications').delete().eq('id', notificationId);
            await loadNotifications();
        };
    </script>
    
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        #app {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            overflow: hidden;
        }
        
        header {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        header h1 {
            margin: 0;
            font-size: 1.8em;
        }
        
        button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
            transition: all 0.3s ease;
        }
        
        button:hover {
            background: #45a049;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        
        button:active {
            transform: translateY(0);
        }
        
        #tabs {
            background: #f8f9fa;
            display: flex;
            border-bottom: 2px solid #e9ecef;
            overflow-x: auto;
        }
        
        .tab-btn {
            background: transparent;
            color: #666;
            border: none;
            padding: 15px 20px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            white-space: nowrap;
            transition: all 0.3s ease;
        }
        
        .tab-btn:hover {
            background: rgba(102, 126, 234, 0.1);
            color: #667eea;
            transform: none;
            box-shadow: none;
        }
        
        .tab-btn.active {
            color: #667eea;
            border-bottom-color: #667eea;
            background: white;
        }
        
        .tab-content {
            display: none;
            padding: 30px;
            min-height: 500px;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .tab-content h2 {
            margin-top: 0;
            color: #333;
            border-bottom: 2px solid #e9ecef;
            padding-bottom: 10px;
        }
        
        #stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
        }
        
        .stat-card h3 {
            margin: 0 0 10px 0;
            font-size: 14px;
            opacity: 0.9;
        }
        
        .stat-card span {
            font-size: 2em;
            font-weight: bold;
        }
        
        .user-card {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 10px;
            padding: 15px;
            margin: 10px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease;
        }
        
        .user-card:hover {
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            transform: translateY(-2px);
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .user-info img {
            border-radius: 50%;
            object-fit: cover;
        }
        
        .user-actions {
            display: flex;
            gap: 10px;
        }
        
        #chat-messages {
            height: 300px;
            overflow-y: auto;
            border: 1px solid #e9ecef;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
            background: #f8f9fa;
        }
        
        .message {
            margin-bottom: 15px;
            padding: 10px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        
        .message-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 5px;
            font-size: 12px;
            color: #666;
        }
        
        .message-header img {
            border-radius: 50%;
        }
        
        .own-message {
            color: #667eea;
            font-weight: bold;
        }
        
        .timestamp {
            margin-left: auto;
            font-size: 11px;
            opacity: 0.7;
        }
        
        .message-content {
            padding: 5px 0;
            font-size: 14px;
            line-height: 1.4;
        }
        
        #chat-input-section {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        #message-input {
            flex: 1;
            padding: 12px;
            border: 1px solid #e9ecef;
            border-radius: 25px;
            font-size: 14px;
            outline: none;
            transition: border-color 0.3s ease;
        }
        
        #message-input:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        #profile-form {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        
        #profile-form div {
            margin-bottom: 15px;
        }
        
        #profile-form label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #333;
        }
        
        #profile-form input,
        #profile-form textarea,
        #profile-form select {
            width: 100%;
            padding: 10px;
            border: 1px solid #e9ecef;
            border-radius: 5px;
            font-size: 14px;
            font-family: inherit;
            box-sizing: border-box;
        }
        
        #profile-form input:focus,
        #profile-form textarea:focus,
        #profile-form select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .activity-item {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            transition: all 0.3s ease;
        }
        
        .activity-item:hover {
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            transform: translateX(5px);
        }
        
        .notification {
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            background: white;
            transition: all 0.3s ease;
        }
        
        .notification:hover {
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .notification.unread {
            border-left: 4px solid #667eea;
            background: #f8f9ff;
        }
        
        .notification-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .unread-indicator {
            font-size: 8px;
        }
        
        .notification-message {
            color: #666;
            margin-bottom: 10px;
            line-height: 1.4;
        }
        
        .notification-actions {
            display: flex;
            gap: 10px;
        }
        
        #recent-activity {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
        }
        
        #recent-activity ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        
        #recent-activity li {
            padding: 10px 0;
            border-bottom: 1px solid #e9ecef;
            transition: all 0.3s ease;
        }
        
        #recent-activity li:hover {
            background: white;
            margin: 0 -10px;
            padding: 10px;
            border-radius: 5px;
        }
        
        #recent-activity li:last-child {
            border-bottom: none;
        }
        
        #user-controls,
        #notification-controls,
        #activity-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        select {
            padding: 8px 12px;
            border: 1px solid #e9ecef;
            border-radius: 5px;
            background: white;
            font-size: 14px;
        }
        
        /* Responsive design */
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            
            header {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }
            
            .tab-content {
                padding: 20px;
            }
            
            #stats {
                grid-template-columns: 1fr;
            }
            
            .user-card {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }
            
            .user-info {
                flex-direction: column;
                text-align: center;
            }
            
            #chat-input-section {
                flex-direction: column;
            }
            
            #message-input {
                margin-bottom: 10px;
            }
            
            #user-controls,
            #notification-controls,
            #activity-controls {
                flex-direction: column;
            }
        }
        
        /* Loading animation */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Smooth transitions */
        * {
            transition: all 0.3s ease;
        }
        
        /* Scrollbar styling */
        ::-webkit-scrollbar {
            width: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: #667eea;
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: #5a6fd8;
        }
    </style>
</body>
</html>
